<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Centri Home Assistant Propane Tank Card Demo</title>
    <style>
        /* Dark theme (default) */
        :root {
            --primary-text-color: #e1e1e1;
            --secondary-text-color: #9b9b9b;
            --primary-color: #03a9f4;
            --primary-background-color: #111111;
            --secondary-background-color: #1c1c1c;
            --card-background-color: #1e1e1e;
            --divider-color: #3a3a3a;
            --input-background-color: #2e2e2e;
            --input-border-color: #555555;
        }

        /* Light theme */
        body.light-theme {
            --primary-text-color: #212121;
            --secondary-text-color: #727272;
            --primary-color: #03a9f4;
            --primary-background-color: #fafafa;
            --secondary-background-color: #e7e7e7;
            --card-background-color: #ffffff;
            --divider-color: #e0e0e0;
            --input-background-color: #ffffff;
            --input-border-color: #cccccc;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--primary-background-color);
            color: var(--primary-text-color);
            padding: 20px;
            margin: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: left;
            margin-bottom: 0;
        }

        .demo-section {
            margin-bottom: 40px;
        }

        .cards-container {
            display: flex;
            justify-content: left;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Match SVG native dimensions */
        ha-centri-propane-tank-card {
            display: block;
            width: 243px;
            max-width: 100%;
        }
        
        ha-centri-propane-tank-card .tank-body {
            height: 104px;
        }

        .controls {
            background: var(--secondary-background-color);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
        }

        .controls h2 {
            margin-top: 0;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .theme-toggle button {
            background: var(--card-background-color);
            color: var(--primary-text-color);
            border: 2px solid var(--divider-color);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .theme-toggle button:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .control-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }

        input[type="number"] {
            width: 80px;
            padding: 8px;
            background: var(--input-background-color);
            border: 1px solid var(--input-border-color);
            color: var(--primary-text-color);
            border-radius: 4px;
            margin-right: 10px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        button {
            background: #03a9f4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 5px;
        }

        button:hover {
            background: #0288d1;
        }

        button.secondary {
            background: #666;
        }

        button.secondary:hover {
            background: #555;
        }

        .value-display {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            color: #03a9f4;
        }

        ha-card {
            display: block;
            background: var(--card-background-color);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }

        body.light-theme ha-card {
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div class="theme-toggle">
        <button onclick="toggleTheme()" id="themeToggleBtn">üåô Dark Mode</button>
    </div>

    <div class="container">
        <h1>Centri Home Assistant Propane Tank Card Demo</h1>

        <div class="controls">
            <h2>Test Controls</h2>
            
            <div class="control-group">
                <label>
                    Tank Size: <span class="value-display" id="tankSizeDisplay">500 gal</span>
                </label>
                <input type="number" id="tankSizeInput" min="1" max="10000" value="500" style="width: 100px;">
                <button onclick="updateTankSize()">Update Size</button>
            </div>
            
            <div class="control-group">
                <label>
                    Tank Level: <span class="value-display" id="levelDisplay">75%</span>
                </label>
                <input type="range" id="levelSlider" min="0" max="100" value="75" step="1">
                <input type="number" id="levelInput" min="0" max="100" value="75">
                <button onclick="updateLevel()">Set Level</button>
                <button id="animateBtn" onclick="animateLevel()" style="background: #34c759;">Animate</button>
            </div>

            <div class="control-group">
                <label>Quick Tests:</label>
                <button onclick="setLevel(100)">Full (100%)</button>
                <button onclick="setLevel(75)">Good (75%)</button>
                <button onclick="setLevel(50)">Medium (50%)</button>
                <button onclick="setLevel(25)">Low (25%)</button>
                <button onclick="setLevel(10)">Critical (10%)</button>
                <button onclick="setLevel(0)">Empty (0%)</button>
            </div>

            <div class="control-group">
                <label>Error States:</label>
                <button class="secondary" onclick="testUnavailable()">Unavailable</button>
                <button class="secondary" onclick="testInvalid()">Invalid (NaN)</button>
            </div>
        </div>

        <div class="demo-section">
            <h2>Live Card</h2>
            <div class="cards-container">
                <ha-centri-propane-tank-card id="card1"></ha-centri-propane-tank-card>
            </div>
        </div>
    </div>

    <!-- Load the custom card -->
    <script type="module" src="./dist/ha-centri-propane-tank-card.js"></script>

    <script>
        // Mock Home Assistant (hass) object
        let currentLevel = 75;
        let tankSize = 500; // Default tank size in gallons
        
        const mockHass = {
            states: {
                'sensor.propane_tank_level': {
                    state: '75',
                    attributes: {
                        unit_of_measurement: '%',
                        friendly_name: 'Propane Tank Level'
                    }
                }
            }
        };

        let card;

        // Wait for custom element to be defined
        customElements.whenDefined('ha-centri-propane-tank-card').then(() => {
            // Get card element
            card = document.getElementById('card1');

            // Configure the card
            card.setConfig({
                entity: 'sensor.propane_tank_level',
                tank_size: tankSize
            });

            // Initial update
            card.hass = mockHass;
        });

        // Sync slider and input
        document.getElementById('levelSlider').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            document.getElementById('levelInput').value = value;
            document.getElementById('levelDisplay').textContent = value + '%';
            setLevel(value); // Automatically update the card
        });

        document.getElementById('levelInput').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            if (!isNaN(value)) {
                document.getElementById('levelSlider').value = value;
                document.getElementById('levelDisplay').textContent = value + '%';
                setLevel(value); // Automatically update the card
            }
        });

        // Tank size update
        document.getElementById('tankSizeInput').addEventListener('input', (e) => {
            const value = parseFloat(e.target.value);
            if (!isNaN(value) && value > 0) {
                document.getElementById('tankSizeDisplay').textContent = value + ' gal';
            }
        });

        function updateTankSize() {
            const size = parseFloat(document.getElementById('tankSizeInput').value);
            if (!isNaN(size) && size > 0) {
                tankSize = size;
                document.getElementById('tankSizeDisplay').textContent = size + ' gal';
                // Reconfigure the card with new tank size
                if (card) {
                    card.setConfig({
                        entity: 'sensor.propane_tank_level',
                        tank_size: tankSize
                    });
                    // Re-render current level to update gallons display
                    setLevel(currentLevel);
                }
            }
        }

        // Update level function
        function updateLevel() {
            const level = document.getElementById('levelInput').value;
            setLevel(parseFloat(level));
        }

        function setLevel(level) {
            if (!card) return;
            
            currentLevel = level;
            
            // Create a completely new hass object to trigger update
            const newHass = {
                states: {
                    'sensor.propane_tank_level': {
                        state: level.toString(),
                        attributes: {
                            unit_of_measurement: '%',
                            friendly_name: 'Propane Tank Level'
                        }
                    }
                }
            };
            
            card.hass = newHass;
            
            // Update UI
            document.getElementById('levelSlider').value = level;
            document.getElementById('levelInput').value = level;
            document.getElementById('levelDisplay').textContent = level + '%';
        }

        // Test unavailable state
        function testUnavailable() {
            mockHass.states['sensor.propane_tank_level'].state = 'unavailable';
            card.hass = { ...mockHass };
            document.getElementById('levelDisplay').textContent = 'unavailable';
        }

        // Test invalid state (NaN)
        function testInvalid() {
            mockHass.states['sensor.propane_tank_level'].state = '';
            card.hass = { ...mockHass };
            document.getElementById('levelDisplay').textContent = 'invalid';
        }

        // Animation control variables
        let animationFrameId = null;
        let isAnimating = false;

        // Animate from 0 to 100 and back to 0
        function animateLevel() {
            const animateBtn = document.getElementById('animateBtn');
            
            // If already animating, stop it
            if (isAnimating) {
                stopAnimation();
                return;
            }
            
            // Start animation from current level
            const currentVal = parseFloat(document.getElementById('levelInput').value) || 0;
            
            isAnimating = true;
            animateBtn.style.background = '#ff3b30'; // Red during animation
            animateBtn.textContent = 'Stop Animation';
            
            // Animate up to 100 from current level
            animateLevelRange(currentVal, 100, 20000 * (100 - currentVal) / 100, () => {
                if (!isAnimating) return; // Check if stopped
                // Then animate back down to 0
                animateLevelRange(100, 0, 20000, () => {
                    stopAnimation();
                });
            });
        }

        function stopAnimation() {
            const animateBtn = document.getElementById('animateBtn');
            
            // Cancel any pending animation frames
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            
            // Reset button state
            isAnimating = false;
            animateBtn.style.background = '#34c759'; // Green default
            animateBtn.textContent = 'Animate';
        }

        function animateLevelRange(start, end, duration, callback) {
            const startTime = performance.now();
            let lastUpdateTime = startTime;
            const updateInterval = 1000; // 1 second delay between updates
            
            function animate(now) {
                // Check if animation was stopped
                if (!isAnimating) {
                    return;
                }
                
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const currentLevel = start + (end - start) * progress;
                
                // Only update if 1 second has passed since last update
                if (now - lastUpdateTime >= updateInterval || progress === 1) {
                    setLevel(Math.round(currentLevel));
                    lastUpdateTime = now;
                }
                
                if (progress < 1) {
                    animationFrameId = requestAnimationFrame(animate);
                } else if (callback) {
                    callback();
                }
            }
            animationFrameId = requestAnimationFrame(animate);
        }

        // Allow Enter key to set level
        document.getElementById('levelInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                updateLevel();
            }
        });

        // Theme toggle functionality
        function toggleTheme() {
            const body = document.body;
            const btn = document.getElementById('themeToggleBtn');
            
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                btn.textContent = 'üåô Dark Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light-theme');
                btn.textContent = '‚òÄÔ∏è Light Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme preference
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            const btn = document.getElementById('themeToggleBtn');
            
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                btn.textContent = '‚òÄÔ∏è Light Mode';
            } else {
                btn.textContent = 'üåô Dark Mode';
            }
        });
    </script>
</body>
</html>
